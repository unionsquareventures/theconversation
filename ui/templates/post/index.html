{% extends '../base.html' %}
{% block body_class %}conversation{% end %}

{% block javascript %}
  <script>
  $(document).ready(function() {
    $('#bookmarklet').click(function(e) {
      e.preventDefault();
      alert('This is bookmarklet.  First drag it to your bookmarks bar, then you can use it to share web pages to USV.com.');
    })

    // Truncate featured post text
    $('.excerpt').text(function(e) {
      var text = $(this).text();
      console.log(text.match(/\.{3}/));
      if (text.match(/\.{3}/)) {
        console.log(text)
        var i = text.lastIndexOf(' ');
        if (i != -1) {
          text = text.substr(0,i) + "..."
        }
        console.log(text)
      }
      return text;
  });
  
    fp_max_height = 0;
    $('.featured-post').each(function() {
      if ($(this).height() > fp_max_height) {
        fp_max_height = $(this).height();
      }
    })
    
    if ($('.featured-post:visible').length == 2) {
      /* only do this on ipad where we're showing two at the top */
      $('.featured-post').height(fp_max_height);
    }
  
}); 
  </script>
{% end %}

{% block precontent %}
    <div class="tools tools-mobile visible-xs"><b>Welcome!</b> &nbsp; <a href="http://127.0.0.1:8888/posts/welcome-to-the-new-usvcom">Posting guidelines</a> | <a href="https://play.google.com/store/apps/details?id=com.connectedio.usvmobile" target="_blank">Android app</a> </div>
{% end %}


{% block content %}
<div id="main" role="main">
    <section class="featured-feed clearfix{{ ' mobile-hidden' if (rstart > 0) or sort_by_specified else '' }}">
        <!--<ul class="tabs">
            <li><a class="current" href="/featured_posts">Featured</a></li>
        </ul>-->
        
        <div id='slider' class='swipe visible-xs row'>
          <ul class='swipe-wrap feed'>
            {% for i, post in enumerate(sticky) %}
            <div class="featured-post">
            <div class="content">
                  <a class="title" href="/posts/{{ post.slug }}">{{ post.title }}</a>
              {% if post.url %}
                  <a href="{{ post.url }}" class="source" target="_blank">{{ urlparse(post.url).netloc }}</a>
              {% else %}
                  <a href="/posts/{{ post.slug }}" class="source">usv.com</a>
              {% end %}
              <div class="excerpt">{{ post.body_truncated }}</div>
              <div class="meta">
                  <div class="thumbnail">
                    <a href="http://www.twitter.com/{{ post.user.username }}" target="_blank">
                      <img title="{{ post.user.username }}" src="{{ twitter_avatar_size(post.user.profile_image_url_https, 'normal') }}" alt="thumbnail">
                    </a>
                  </div>
                  @{{ post.user.username }}
                  <span class="time">{{ pretty_date(post.date_created) }}</span>
                  {% module ajax_upvote_link(post=post) %}
                  <a class="comments-count" href="/posts/{{ post.slug }}"
                      data-disqus-identifier="{{ post.id }}" target="_blank">0 comments</a>
              </div>
            </div>
            </div>
            {% end %}
            {% for i, post in enumerate(featured_posts) %}
            <div class="featured-post">
            <div class="content">
                  <a class="title" href="/posts/{{ post.slug }}">{{ post.title }}</a>
              {% if post.url %}
                  <a href="{{ post.url }}" class="source" target="_blank">{{ urlparse(post.url).netloc }}</a>
              {% else %}
                  <a href="/posts/{{ post.slug }}" class="source">usv.com</a>
              {% end %}
              <div class="excerpt">{{ post.body_truncated }}</div>
              <div class="meta">
                  <div class="thumbnail">
                    <a href="http://www.twitter.com/{{ post.user.username }}" target="_blank">
                      <img title="{{ post.user.username }}" src="{{ twitter_avatar_size(post.user.profile_image_url_https, 'normal') }}" alt="thumbnail">
                    </a>
                  </div>
                  @{{ post.user.username }}
                  <span class="time">{{ pretty_date(post.date_created) }}</span>
                  {% module ajax_upvote_link(post=post) %}
                  <a class="comments-count" href="/posts/{{ post.slug }}"
                      data-disqus-identifier="{{ post.id }}" target="_blank">0 comments</a>
              </div>
            </div>
            </div>
            {% end %}
          </ul>
        </div>
        
        <ul class="feed hidden-xs" id="homepage-featured-posts">
          {% for post in sticky %}
            {% module featured_post(post=post, urlparse=urlparse, show_votes=True, show_source=True) %}
          {% end %}
          
          {% for post in featured_posts %}
            {% module featured_post(post=post, urlparse=urlparse, show_votes=True, show_source=True) %}
          {% end %}
        </ul><!--end of feed-->
        <a class="more-link" href="/featured_posts">Featured Posts</a>
    </section><!--end of featured-feed-->

    <section class="hot-newest-feed">
      <ul class="tabs">
          <li class="{{ 'is-active' if sort_by == 'hot' else '' }}"><a class="sort btn" href="?sort_by=hot">Hot</a></li>
          <li class="{{ 'is-active' if sort_by == 'new' else '' }}"><a class="sort btn" href="?sort_by=new">Newest</a></li>
          {% if not is_blacklisted %}
          <li class="submit-btn">
            <!--<a class="btn btn-primary" role="button"
            data-toggle="modal" href="#submit-modal">Submit a post</a>-->
            <a class="btn btn-primary" role="button" href="/posts/new">Submit a post</a>          
          </li>
          {% end %}
        </ul>
        <ul class="tools hidden-xs" id="tools-desktop">
          <li><a href="/posts/welcome-to-the-new-usvcom#comment-1066849399">Guidelines</a></li>
          <li><a href="/tools">Tools</a></li>
        </ul>

        <ul class="feed">
            {% if count == 0 and rstart != 0 %}
              <li class="new_posts_notification">
                <a href="/?sort_by={{ sort_by }}" class="new_posts_link">New posts ({{ rstart }})</a>
              </li>
            {% end %}

            {% for post in posts %}
            <li>
              <div class="avatar">
                <a href="http://www.twitter.com/{{ post.user.username }}" target="_blank">
                <img title="{{ post.user.username }}" src="{{ twitter_avatar_size(post.user.profile_image_url_https, 'normal') }}" alt="thumbnail">
                </a>
              </div>
              <div class="content">
            
                {% if post.url %}
                    <a class="title" href="{{ post.url }}" target="_blank">{{ post.title }}</a>
                    <a href="{{ post.url }}" class="source" target="_blank">{{ urlparse(post.url).netloc }}</a>
                {% else %}
                    <a class="title" href="/posts/{{ post.slug }}" target="_blank">{{ post.title }}</a>
                    <a href="/posts/{{ post.slug }}" class="source" target="_blank">usv.com</a>
                {% end %}
            
                <div class="meta">
                  <a class="username-link" href="http://www.twitter.com/{{ post.user.username }}" target="_blank" style="color: #999">@{{ post.user.username }}</a>
                  <span class="username" style="">@{{ post.user.username }}</span>
                  
                  {% module ajax_upvote_link(post=post) %}                
                  <span class="time"><a href="/posts/{{ post.slug }}" ><span class="glyphicon glyphicon-link" style="margin: 0;font-size: 90%"></span> {{ pretty_date(post.date_created) }}</a></span>
                  <a href="/posts/{{ post.slug }}" ><span class="glyphicon glyphicon-comment" style="margin: 0;font-size: 90%"></span></a> <a class="" href="/posts/{{ post.slug }}" data-disqus-identifier="{{ post.id }}">1 comment</a>
                </div>
              </div>
              </li>              
            {% end %}
        </ul><!--end of feed-->

        <div id="pagination-next-prev">
          {% if rstart > 0 %}
              <a class="prev-page" href="?sort_by={{ sort_by }}&anchor={{ posts[0].id }}&action=before&count={{ count - per_page }}">Prev</a>
          {% end %}
          {% if rend < num_posts - 1 %}
              <a class="next-page" href="?sort_by={{sort_by }}&anchor={{ posts[-1].id }}&action=after&count={{ count + per_page }}">Next</a>
          {% end %}
        </div>
    </section>
  </div><!--end of main-->
{% end %}
