<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>{% block title %}{% end %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=0.75, maximum-scale=0.75, user-scalable=0">
    <meta name="description" content="">
    <meta name="author" content="">

    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/css/bootstrap-responsive.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/font-awesome.min.css">
    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro' rel='stylesheet' type='text/css'>
    
    <link rel="stylesheet" type="text/css" href="/static/css/main_new.css" />

    <!--<link href="/static/css/modules_bundle.css" rel="stylesheet">-->
    {% block css %}
    {% end %}

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->


    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/jquery.tappable.js"></script>
    
    <!-- -->
    <script src="/static/js/jquery.autoellipsis.min.js"></script>
    <script src="/static/js/jquery.masonry.min.js"></script>
    <script src="/static/js/jquery.jscroll.min.js"></script>
    <!-- -->

    <!--<script src="/static/js/modules_bundle.js"></script>-->


    <script type="text/javascript">
       function adjust_post() {
         $('.post').each(function(i, o) {
             var h = $(this).height();
             console.log(h);
             h = h / 2 - 38;
             $(this).closest('.post').children('.avatar').css({'margin-top': h});

             if($(this).height() == 100) {
              $(this).closest('.post').children('.info').css({'margin-top': 22});
             }
         });
       };

       function fix_scrolling_streams() {
         // Fix featured and non-featured post stream
          var top_height = $('#navigation_bar').height() + $('#featured_posts_bar').height() + 25;
          $('#featured_post_stream').height($(window).innerHeight() - top_height);
          $('#post_stream').height($(window).innerHeight() - top_height);
       }

      $(window).resize(function() { 
          adjust_post();
          fix_scrolling_streams();
      });

      $(function() {
          // Fix featured post borders
          $('.post.featured').prev().css({'border-bottom': 'none'});
          // Fix left featured post stream height
          fix_scrolling_streams();
          // Fix mobile Safari quirks
          $('#myimage').click(function() { return false; });
          $('#myimage').off('click');
          $("#navigation_button").tappable(function() {
            $("#navigation_button").toggleClass("active");
            $("#navigation_items").collapse('toggle');
           });

          // Hide iPhone URL bar
          window.scrollTo(0, 1);

          // Fixup avatars and title
          adjust_post();
       });
    </script>

    {% block javascript %}
    {% end %}
  </head>

  <body>
    {% module nav_bar() %}

    {% block content %}
    {% end %}

    {% module analytics_tags(settings=settings) %}
  </body>
</html>
