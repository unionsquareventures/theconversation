{% set action = '/posts/' + str(post.slug) if not post._created else '/posts/' %}

<script type="text/javascript">
    $(function() {
        $('.field-errors').each(function() {
            if($.trim($(this).html()) == '') {
                $(this).hide();
            }
        });
        $('a.no-match').on('click', function(e) {
            $('#bypass_dup_check').val('true');
            $(this).closest('.field-errors').hide();
        });
    });
</script>

<form id="{{ id }}" class="form {{ classes }}" action="{{ action }}" method="POST">
    {% module xsrf_form_html() %}

    <!--<span class="form-title">Post</span>-->
    <fieldset>
        <dl>
            <dt>
                <label for="title">Title</label>
                <div class="field-errors">{{ field_errors(errors, 'title') }}</div>
            </dt>
            <dd>
                <input id="post_title" name="title" type="text" class="form-control" 
                            placeholder="Your Post Title" required="" value="{{ post.title or '' }}">
            </dd>
            <dt>
                <label for="url">Link</label>
                <div class="field-errors">{{ field_errors(errors, 'url') }}
                    {% if existing_posts %}
                        <div id="existing-posts">
                        This URL might have already been submitted. Does it
                        match one of these?
                        <ul>
                            {% for p in existing_posts %}
                                <li><a href="{{ p.url }}" target="_blank">{{ p.title }}</a></li>
                            {% end %}
                        </ul>
                        <span class="no-match btn">
                            <a href="#" class="no-match">&times; Ignore</a>
                        </span>
                        </div>
                    {% end %}
                </div>
                <input type="hidden" name="bypass_dup_check"
                        id="bypass_dup_check" value="{{ 'true' if (post.url and not existing_posts) else '' }}" />
            </dt>
            <dd>
                <input id="post_url" name="url" type="text" placeholder="http://example.com" 
                            value="{{ post.url or '' }}" class="form-control">
            </dd>
            <dt>
                <label for="body_raw">Body</label>
                <div class="field-errors">{{ field_errors(errors, 'body_raw') }}</div>
            </dt>
            <dd class="tinymce-textbox"> 
                <textarea type="text" class="form-control" id="post_body_raw" name="body_raw">
                {{ post.body_raw or '' }}
                </textarea>
            </dd>
            <dt>
                <label for="url">Tags (separate by comma)</label>
                <div class="field-errors">{{ field_errors(errors, 'tags') }}</div>
            </dt>
            <dd>
                <input id="post_tags" name="tags" type="text" placeholder="pitch, meta, health, mobile, education"
                                        value="{{ ', '.join(post.tags) if post.tags else '' }}" class="form-control">
            </dd>
            <!--
            <li class="hackpad">
                <div id="toggle-hackpad-url" class="{{ 'checked' if post.has_hackpad else '' }}"></div>
                <input id="post_has_hackpad" name="has_hackpad" type="hidden" value="{{ 'true' if post.has_hackpad else '' }}">
                <label for="hackpad_url">Hackpad URL</label>
                <div class="field-errors">{{ field_errors(errors, 'hackpad_url') }}</div>
                <input id="post_hackpad_url" name="hackpad_url" type="text" value="{{ post.hackpad_url or '' }}"
                                        style="display: {{'block' if post.has_hackpad else 'none' }};" />
            </li>
        -->
        
        {% if handler.is_admin() %}
            <dt class="featured">
                    <div id="toggle-featured"></div>
                    <label for="post_featured">Featured</label>
                    <div class="field-errors">{{ field_errors(errors, 'featured') }}</div>
            </dt>
            <dd>
                    <input type="checkbox" id="post_featured" name="featured" value="true"
                                            {{ 'checked' if post.featured else '' }} />
            </dd>
        {% end %}    

        <!-- Used when AJAX was utilized for checking if user is staff
            <dt class="submit-staff" style="display:none">
                    <div id="toggle-featured"></div>
                    <label for="post_featured">Featured</label>
                    <div class="field-errors">{{ field_errors(errors, 'featured') }}</div>
            </dt>
            <dd>
                    <input class="submit-staff" style="display:none" type="checkbox" id="post_featured" name="featured" value="true"
                                            {{ 'checked' if post.featured else '' }} />
            </dd>
        --> 
            
            
            
            {% if not post._created %}
            <li class="deleted">
                    <div id="toggle-deleted"></div>
                    <label for="post_deleted">Deleted</label>
                    <div class="field-errors">{{ field_errors(errors, 'deleted') }}</div>
                    <input type="checkbox" id="post_deleted" name="deleted" value="true"
                                            {{ 'checked' if post.deleted else '' }} />
            </li>
            {% end %}
            
            <div class="for-submit" style="padding: 10px; text-align:right">
                <button type="submit" class="btn btn-primary">Submit</button>
            </div>
        </ol>
    </fieldset>
</form>
